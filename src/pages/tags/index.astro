---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const allPosts = await getCollection('blog');

// Extract all unique tags and count posts per tag
const tagCounts = new Map();
allPosts.forEach(post => {
  if (post.data.tags) {
    post.data.tags.forEach(tag => {
      tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
    });
  }
});

// Sort tags alphabetically
const sortedTags = Array.from(tagCounts.entries()).sort((a, b) => a[0].localeCompare(b[0]));
---

<BaseLayout pageTitle="Tags" description="Browse blog posts by tag">
	<h1>Tags</h1>
	<p>Browse all blog posts organized by topic.</p>
	
	<div class="tag-cloud">
		{sortedTags.map(([tag, count]) => (
			<a href={`/tags/${tag.toLowerCase().replace(/\s+/g, '-')}`} class="tag-link">
				<span class="tag-name">{tag}</span>
				<span class="tag-count">({count})</span>
			</a>
		))}
	</div>
	
	<nav class="tags-navigation">
		<a href="/blog" class="back-to-blog">&larr; Back to Blog</a>
	</nav>
</BaseLayout>

<style>
	h1 {
		margin-top: var(--spacing-2xl);
		color: var(--color-purple); /* Fallback */
		background: var(--gradient-sunrise);
		background-clip: text;
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		color: transparent;
	}

	.tag-cloud {
		display: flex;
		flex-wrap: wrap;
		gap: var(--spacing-md);
		margin: var(--spacing-2xl) 0;
	}

	.tag-link {
		display: inline-flex;
		align-items: center;
		gap: var(--spacing-sm);
		padding: var(--spacing-sm) var(--spacing-md);
		background: var(--color-bg-tertiary);
		border: 1px solid var(--color-border);
		border-radius: var(--radius-lg);
		text-decoration: none;
		transition: all var(--transition-fast);
		color: var(--color-text-primary);
	}

	.tag-link:hover {
		background: var(--color-surface);
		border-color: var(--color-border-hover);
		transform: translateY(-2px);
		box-shadow: var(--shadow-sm);
		text-decoration: none;
	}

	.tag-name {
		font-weight: var(--font-weight-semibold);
	}

	.tag-count {
		color: var(--color-text-tertiary);
		font-size: var(--font-size-sm);
	}

	.tags-navigation {
		margin-top: var(--spacing-2xl);
		padding-top: var(--spacing-xl);
		border-top: 1px solid var(--color-border);
		text-align: center;
	}

	.back-to-blog {
		color: var(--color-primary);
		font-weight: var(--font-weight-medium);
		font-size: var(--font-size-base);
		text-decoration: none;
		padding: var(--spacing-sm) var(--spacing-lg);
		border-radius: var(--radius-md);
		transition: all var(--transition-fast);
		display: inline-block;
	}

	.back-to-blog:hover {
		background: var(--color-bg-tertiary);
		text-decoration: none;
	}
</style>