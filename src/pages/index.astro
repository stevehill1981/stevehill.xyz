---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import { getReadingTime } from '../utils/readingTime.js';

// Get recent blog posts
const allPosts = await getCollection('blog');
const recentPosts = allPosts
	.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
	.slice(0, 3);

// Get reading times for recent posts
const recentPostsWithReadingTime = await Promise.all(
	recentPosts.map(async (post) => {
		const { body } = await post.render();
		return {
			...post,
			readingTime: getReadingTime(body)
		};
	})
);

// Get projects, sorted with featured ones first
const allProjects = (await getCollection('projects'))
	.sort((a, b) => {
		// Featured projects first
		const aFeatured = a.data.featured ?? false;
		const bFeatured = b.data.featured ?? false;
		if (aFeatured && !bFeatured) return -1;
		if (!aFeatured && bFeatured) return 1;
		// Then sort alphabetically by title
		return a.data.title.localeCompare(b.data.title);
	});
---

<BaseLayout pageTitle="Home">
	<div class="hero">
		<h1 class="hero-title">Steve Hill</h1>
		<p class="hero-subtitle">Software Engineer. Storyteller. Explorer.</p>
		
		<div class="hero-links">
			<a href="/about" class="hero-link">About</a>
			<span class="dot">&middot;</span>
			<a href="/now" class="hero-link">Now</a>
			<span class="dot">&middot;</span>
			<a href="/blog" class="hero-link">Blog</a>
			<span class="dot">&middot;</span>
			<a href="/projects" class="hero-link">Projects</a>
			<span class="dot">&middot;</span>
			<a href="https://code198x.stevehill.xyz" target="_blank" rel="noopener" class="hero-link">Code Like It's 198x</a>
		</div>
		
		<div class="hero-social">
			<a href="mailto:steve@stevehill.xyz" aria-label="Email" class="social-link">
				<svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
					<path d="M12 13.065L2.4 6.6V18h19.2V6.6l-9.6 6.465zm9.6-10.065H2.4A1.4 1.4 0 0 0 1 4.4v.27l11 7.41 11-7.41V4.4a1.4 1.4 0 0 0-1.4-1.4z"/>
				</svg>
			</a>
			<a href="https://github.com/stevehill1981" target="_blank" rel="noopener" aria-label="GitHub" class="social-link">
				<svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
					<path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.438 9.8 8.205 11.387.6.113.82-.263.82-.582 0-.288-.012-1.243-.017-2.252-3.338.726-4.042-1.61-4.042-1.61-.546-1.387-1.333-1.756-1.333-1.756-1.09-.745.083-.729.083-.729 1.205.085 1.84 1.237 1.84 1.237 1.07 1.834 2.807 1.304 3.492.997.108-.775.418-1.305.762-1.606-2.665-.304-5.466-1.332-5.466-5.93 0-1.31.468-2.38 1.236-3.22-.124-.303-.535-1.523.117-3.176 0 0 1.008-.322 3.3 1.23a11.52 11.52 0 0 1 3.003-.404c1.02.005 2.047.138 3.003.404 2.29-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.873.12 3.176.77.84 1.235 1.91 1.235 3.22 0 4.61-2.803 5.625-5.475 5.922.43.372.823 1.104.823 2.226 0 1.606-.015 2.898-.015 3.293 0 .322.216.699.825.58C20.565 21.796 24 17.297 24 12c0-6.63-5.37-12-12-12z"/>
			</svg>
			</a>
		</div>
	</div>
	
	<section class="home-section">
		<div class="section-header">
			<h2>Recent Posts</h2>
			<a href="/blog" class="view-all">View all posts →</a>
		</div>
		
		<div class="recent-posts">
			{recentPostsWithReadingTime.map((post) => (
				<article class="post-card">
					<div class="post-meta">
						<time>{post.data.pubDate.toLocaleDateString('en-US', { 
							year: 'numeric', 
							month: 'short', 
							day: 'numeric' 
						})}</time>
						<span class="reading-time">{post.readingTime} min read</span>
					</div>
					<h3 class="post-title">
						<a href={`/blog/${post.slug}`}>{post.data.title}</a>
					</h3>
					<p class="post-excerpt">{post.data.excerpt}</p>
				</article>
			))}
		</div>
	</section>
	
	<section class="home-section">
		<div class="section-header">
			<h2>Projects</h2>
			<a href="/projects" class="view-all">View all projects →</a>
		</div>
		
		<div class="projects-grid">
			{allProjects.filter(project => project.data.featured).map((project) => (
				<article class={`project-card-home ${project.data.featured ? 'featured' : ''}`}>
					<div class="project-header project-gradient" data-project={project.data.title}>
						<h3>{project.data.title}</h3>
						{project.data.featured && <span class="featured-badge">Featured</span>}
					</div>
					<div class="project-content">
						<p>{project.data.description}</p>
						<div class="project-links">
							<a href={`/projects/${project.slug}`} class="project-link">Learn more →</a>
							{project.data.github && (
								<a href={project.data.github} target="_blank" rel="noopener" class="github-link">
									<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
										<path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.438 9.8 8.205 11.387.6.113.82-.263.82-.582 0-.288-.012-1.243-.017-2.252-3.338.726-4.042-1.61-4.042-1.61-.546-1.387-1.333-1.756-1.333-1.756-1.09-.745.083-.729.083-.729 1.205.085 1.84 1.237 1.84 1.237 1.07 1.834 2.807 1.304 3.492.997.108-.775.418-1.305.762-1.606-2.665-.304-5.466-1.332-5.466-5.93 0-1.31.468-2.38 1.236-3.22-.124-.303-.535-1.523.117-3.176 0 0 1.008-.322 3.3 1.23a11.52 11.52 0 0 1 3.003-.404c1.02.005 2.047.138 3.003.404 2.29-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.873.12 3.176.77.84 1.235 1.91 1.235 3.22 0 4.61-2.803 5.625-5.475 5.922.43.372.823 1.104.823 2.226 0 1.606-.015 2.898-.015 3.293 0 .322.216.699.825.58C20.565 21.796 24 17.297 24 12c0-6.63-5.37-12-12-12z"/>
									</svg>
									GitHub
								</a>
							)}
						</div>
					</div>
				</article>
			))}
		</div>
	</section>
</BaseLayout>

<style>
	.hero {
		text-align: center;
		padding: var(--spacing-2xl) 0;
		max-width: 600px;
		margin: 0 auto;
		border-bottom: 1px solid var(--color-border);
		margin-bottom: var(--spacing-2xl);
		background: var(--gradient-sunrise-vibrant);
		background-size: 200% 200%;
		animation: gradient-shift 25s ease infinite;
		border-radius: var(--radius-2xl);
		position: relative;
		overflow: hidden;
	}

	/* Add subtle texture overlay for depth */
	.hero::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background-image:
			radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
			radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.08) 0%, transparent 50%);
		pointer-events: none;
		opacity: 0.5;
	}

	@keyframes gradient-shift {
		0%, 100% {
			background-position: 0% 50%;
		}
		50% {
			background-position: 100% 50%;
		}
	}
	
	.hero-title {
		font-family: 'Montserrat', system-ui, sans-serif;
		font-size: var(--font-size-5xl);
		font-weight: var(--font-weight-bold);
		margin: 0 0 var(--spacing-md) 0;
		letter-spacing: -0.02em;
		position: relative;
		z-index: 1;

		/* Generative pattern text mask */
		background:
			radial-gradient(circle at 20% 30%, var(--color-purple) 0%, transparent 50%),
			radial-gradient(circle at 80% 70%, var(--color-cyan) 0%, transparent 50%),
			radial-gradient(circle at 50% 50%, var(--color-pink) 0%, transparent 50%),
			radial-gradient(circle at 10% 80%, var(--color-orange) 0%, transparent 50%),
			radial-gradient(circle at 90% 20%, var(--color-teal) 0%, transparent 50%);
		background-size: 400% 400%;
		background-clip: text;
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		color: transparent;
		animation: pattern-shift 50s ease-in-out infinite;
	}

	@keyframes pattern-shift {
		0%, 100% {
			background-position: 0% 50%;
		}
		25% {
			background-position: 50% 100%;
		}
		50% {
			background-position: 100% 50%;
		}
		75% {
			background-position: 50% 0%;
		}
	}

	.hero-subtitle {
		font-family: 'Inter', system-ui, sans-serif;
		font-size: var(--font-size-xl);
		font-weight: var(--font-weight-semibold);
		margin: 0 0 var(--spacing-2xl) 0;
		position: relative;
		z-index: 1;

		/* Ocean gradient text for contrast with the animated name */
		background: var(--gradient-ocean);
		background-clip: text;
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		color: transparent;
	}

	.hero-links {
		display: flex;
		justify-content: center;
		align-items: center;
		gap: var(--spacing-sm);
		margin-bottom: var(--spacing-xl);
		flex-wrap: wrap;
		position: relative;
		z-index: 1;
	}

	.hero-link {
		font-family: 'Inter', system-ui, sans-serif;
		font-size: var(--font-size-lg);
		font-weight: var(--font-weight-medium);
		color: rgba(255, 255, 255, 0.9);
		text-decoration: none;
		padding: 0.25rem 0.5rem;
		border-radius: var(--radius-md);
		transition: all 0.2s;
		text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
	}

	.hero-link:hover {
		color: white;
		background: rgba(255, 255, 255, 0.15);
		text-decoration: none;
		backdrop-filter: blur(10px);
	}

	.dot {
		color: rgba(255, 255, 255, 0.5);
		font-size: var(--font-size-sm);
	}
	
	.hero-social {
		display: flex;
		justify-content: center;
		gap: var(--spacing-lg);
		margin-top: var(--spacing-xl);
		position: relative;
		z-index: 1;
	}

	.social-link {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		width: 44px;
		height: 44px;
		border-radius: var(--radius-full);
		background: rgba(255, 255, 255, 0.15);
		color: white;
		transition: all 0.2s;
		text-decoration: none;
		backdrop-filter: blur(10px);
		border: 1px solid rgba(255, 255, 255, 0.2);
	}

	.social-link:hover {
		background: rgba(255, 255, 255, 0.25);
		color: white;
		transform: translateY(-2px);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
		text-decoration: none;
		border-color: rgba(255, 255, 255, 0.3);
	}

	.icon {
		width: 20px;
		height: 20px;
	}
	
	/* Home sections */
	.home-section {
		margin-bottom: var(--spacing-2xl);
		animation: fadeIn var(--transition-slow) ease-out;
	}
	
	.section-header {
		display: flex;
		justify-content: space-between;
		align-items: baseline;
		margin-bottom: var(--spacing-lg);
	}
	
	.section-header h2 {
		font-size: var(--font-size-2xl);
		margin: 0;
		color: var(--color-text-primary);
	}
	
	.view-all {
		font-size: var(--font-size-sm);
		color: var(--color-primary);
		font-weight: var(--font-weight-medium);
		transition: transform var(--transition-fast);
	}
	
	.view-all:hover {
		transform: translateX(4px);
	}
	
	/* Recent posts */
	.recent-posts {
		display: flex;
		flex-direction: column;
		gap: var(--spacing-lg);
	}

	.post-card {
		width: 100%;
		padding: var(--spacing-lg);
		background: var(--color-surface);
		border: 1px solid var(--color-border);
		border-left: 6px solid;
		border-radius: var(--radius-lg);
		transition: all var(--transition-base);
	}

	/* Rotate through gradient palettes for each post card */
	.post-card:nth-child(1) {
		border-image: var(--gradient-sunrise) 1;
	}

	.post-card:nth-child(2) {
		border-image: var(--gradient-ocean) 1;
	}

	.post-card:nth-child(3) {
		border-image: var(--gradient-sunset) 1;
	}

	.post-card:hover {
		transform: translateY(-2px);
		border: 2px solid;
		border-left-width: 6px;
		border-radius: var(--radius-lg);
	}

	/* Add gradient-specific hover glow effects */
	.post-card:nth-child(1):hover {
		border-image: var(--gradient-sunrise) 1;
		box-shadow: 0 0 20px rgba(251, 146, 60, 0.3), var(--shadow-md);
	}

	.post-card:nth-child(2):hover {
		border-image: var(--gradient-ocean) 1;
		box-shadow: 0 0 20px rgba(59, 130, 246, 0.3), var(--shadow-md);
	}

	.post-card:nth-child(3):hover {
		border-image: var(--gradient-sunset) 1;
		box-shadow: 0 0 20px rgba(139, 92, 246, 0.3), var(--shadow-md);
	}
	
	.post-meta {
		display: flex;
		gap: var(--spacing-sm);
		font-size: var(--font-size-sm);
		color: var(--color-text-tertiary);
		margin-bottom: var(--spacing-xs);
	}
	
	.reading-time {
		color: var(--color-text-muted);
	}
	
	.post-title {
		font-size: var(--font-size-xl);
		margin: 0 0 var(--spacing-sm) 0;
		line-height: var(--line-height-tight);
	}
	
	.post-title a {
		color: var(--color-text-primary);
		text-decoration: none;
		font-weight: var(--font-weight-semibold);
	}
	
	.post-title a:hover {
		color: var(--color-primary);
	}
	
	.post-excerpt {
		color: var(--color-text-secondary);
		line-height: var(--line-height-relaxed);
		margin: 0;
	}
	
	/* Projects grid */
	.projects-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
		gap: var(--spacing-lg);
	}
	
	.project-card-home {
		background: var(--color-surface);
		border: 1px solid var(--color-border);
		border-radius: var(--radius-lg);
		overflow: hidden;
		transition: all var(--transition-base);
	}
	
	.project-card-home:hover {
		transform: translateY(-4px);
		box-shadow: var(--shadow-lg);
	}
	
	.project-header {
		padding: var(--spacing-lg);
		color: white;
		text-align: center;
		position: relative;
	}

	.project-gradient {
		filter: saturate(1.25);
	}

	.project-header h3 {
		margin: 0;
		font-size: var(--font-size-xl);
		font-weight: var(--font-weight-semibold);
	}

	.featured-badge {
		display: inline-block;
		margin-top: var(--spacing-xs);
		padding: 0.25rem 0.75rem;
		background: rgba(255, 255, 255, 0.2);
		border: 1px solid rgba(255, 255, 255, 0.3);
		border-radius: var(--radius-full);
		font-size: var(--font-size-xs);
		font-weight: var(--font-weight-medium);
		letter-spacing: 0.05em;
		text-transform: uppercase;
		backdrop-filter: blur(10px);
	}

	.project-card-home.featured {
		border-color: var(--color-primary);
		box-shadow: 0 0 0 1px var(--color-primary);
	}

	.project-card-home.featured:hover {
		box-shadow: var(--shadow-xl), 0 0 0 2px var(--color-primary);
	}

	.project-content {
		padding: var(--spacing-lg);
	}
	
	.project-content p {
		color: var(--color-text-secondary);
		line-height: var(--line-height-relaxed);
		margin: 0 0 var(--spacing-md) 0;
		font-size: var(--font-size-base);
	}
	
	.project-links {
		display: flex;
		justify-content: space-between;
		align-items: center;
	}
	
	.project-link {
		font-size: var(--font-size-sm);
		color: var(--color-primary);
		font-weight: var(--font-weight-medium);
		transition: transform var(--transition-fast);
	}
	
	.project-link:hover {
		transform: translateX(4px);
	}
	
	.github-link {
		display: inline-flex;
		align-items: center;
		gap: 0.375rem;
		font-size: var(--font-size-sm);
		color: var(--color-text-secondary);
		text-decoration: none;
		padding: 0.375rem 0.75rem;
		border: 1px solid var(--color-border);
		border-radius: var(--radius-md);
		transition: all var(--transition-fast);
	}
	
	.github-link:hover {
		color: var(--color-text-primary);
		border-color: var(--color-border-hover);
		background: var(--color-bg-tertiary);
	}
	
	@media (max-width: 640px) {
		.hero-title {
			font-size: var(--font-size-4xl);
		}
		
		.hero-subtitle {
			font-size: var(--font-size-lg);
		}
		
		.hero-links {
			font-size: var(--font-size-base);
		}
		
		.section-header {
			flex-direction: column;
			gap: var(--spacing-xs);
		}
		
		.projects-grid {
			grid-template-columns: 1fr;
		}
	}
	
	/* Project gradients */
	/* Featured projects get vibrant gradients */
	.project-gradient[data-project="Rachel - Strategic Card Game"] {
		background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
	}

	.project-gradient[data-project="shiki-highlight-api"] {
		background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
	}

	.project-gradient[data-project="remark-shiki-highlight-api"] {
		background: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%);
	}

	.project-gradient[data-project="PuTTY Themer"] {
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	}

	/* Non-featured projects get neutral gradients */
	.project-gradient:not([data-project="Rachel - Strategic Card Game"]):not([data-project="shiki-highlight-api"]):not([data-project="remark-shiki-highlight-api"]):not([data-project="PuTTY Themer"]) {
		background: linear-gradient(135deg, #64748b 0%, #475569 100%);
	}

	/* Dark mode gradients */
	.project-gradient[data-project="Rachel - Strategic Card Game"] {
		background: linear-gradient(135deg, #c06dd9 0%, #c73f57 100%);
	}

	.project-gradient[data-project="shiki-highlight-api"] {
		background: linear-gradient(135deg, #2563eb 0%, #0891b2 100%);
	}

	.project-gradient[data-project="remark-shiki-highlight-api"] {
		background: linear-gradient(135deg, #7c3aed 0%, #2563eb 100%);
	}

	.project-gradient[data-project="PuTTY Themer"] {
		background: linear-gradient(135deg, #4c5fd8 0%, #5a3885 100%);
	}

	.project-gradient:not([data-project="Rachel - Strategic Card Game"]):not([data-project="shiki-highlight-api"]):not([data-project="remark-shiki-highlight-api"]):not([data-project="PuTTY Themer"]) {
		background: linear-gradient(135deg, #475569 0%, #334155 100%);
	}
</style>